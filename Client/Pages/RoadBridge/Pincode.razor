@page "/roadbridge/pincode"


<MudGrid>
    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudGrid>
            <MudItem xs="12" sm="6" md="6" lg="6" xl="6">
                <MudText Color="Color.Primary" Typo="Typo.h4">Pincode</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="6" lg="6" xl="6" Class="d-flex flex-row-reverse flex-grow-1">
                <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Upload" Color="Color.Primary"
                           OnClick="@UploadCSV" Size="Size.Small">
                    Upload Pincodes
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudItem>

    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudExpansionPanels>
            <MudExpansionPanel Text="Filters" IsInitiallyExpanded="true" @bind-IsExpanded="@isExpanded">
                <EditForm Model="@_pincodeFilter">
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="3" lg="3" xl="3">

                            <MudTextField @bind-Value="@_pincodeFilter.Pincode" Label="Pincode"
                                          Variant="Variant.Outlined" Margin="Margin.Dense" InputType="InputType.Text"
                                          Mask="@(new PatternMask("000000"))"/>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3" lg="3" xl="3">
                            <MudTextField @bind-Value="@_pincodeFilter.Taluka" Label="Taluka" Variant="Variant.Outlined"
                                          Margin="Margin.Dense" InputType="InputType.Text"/>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3" lg="3" xl="3">
                            <MudTextField @bind-Value="@_pincodeFilter.District" Label="District"
                                          Variant="Variant.Outlined" Margin="Margin.Dense" InputType="InputType.Text"/>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="3" lg="3" xl="3">
                            <MudTextField @bind-Value="@_pincodeFilter.State" Label="State" Variant="Variant.Outlined"
                                          Margin="Margin.Dense" InputType="InputType.Text"/>
                        </MudItem>
                        <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
                            <MudButton Color="Color.Primary" ButtonType="ButtonType.Submit"
                                       Variant="Variant.Filled" Class="mr-1" OnClick="@OnSearch" Size="Size.Small">
                                Submit
                            </MudButton>
                            <MudButton Color="Color.Default" ButtonType="ButtonType.Reset"
                                       Variant="Variant.Filled" Class="mr-1" OnClick="@ResetFilters" Size="Size.Small">
                                Reset
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </EditForm>


            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudItem>

    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudTable ServerData="@(new Func<TableState, Task<TableData<SearchPincodeDto>>>(ServerReload))"
                  Breakpoint="Breakpoint.None" LoadingProgressColor="Color.Info" @ref="@_tableRef" Dense="true"
                  RowsPerPage="20" Hover="true">
            <HeaderContent>
                <MudTh>
                    <b>#</b>
                </MudTh>
                <MudTh>
                    <b>@nameof(SearchPincodeDto.Pincode)</b>
                </MudTh>
                <MudTh>
                    <b>@nameof(SearchPincodeDto.Taluka)</b>
                </MudTh>
                <MudTh>
                    <b>@nameof(SearchPincodeDto.District)</b>
                </MudTh>
                <MudTh>
                    <b>@nameof(SearchPincodeDto.State)</b>
                </MudTh>
            </HeaderContent>
            <NoRecordsContent>
                <MudText>No matching records found</MudText>
            </NoRecordsContent>

            <RowTemplate>
                <MudTd DataLabel="#">@GetRowNumber(context)</MudTd>
                <MudTd DataLabel="#" Style="text-align: justify">@context.Pincode</MudTd>
                <MudTd DataLabel="#">@context.Taluka</MudTd>
                <MudTd DataLabel="#">@context.District</MudTd>
                <MudTd DataLabel="#">@context.State</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudPagination SelectedChanged="PageChanged" Color="Color.Secondary"
                               Count="@((_tableRef.GetFilteredItemsCount() + _tableRef.RowsPerPage - 1) / _tableRef.RowsPerPage)"
                               Class="pa-4"/>
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>
